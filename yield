#!/usr/bin/env ruby

# Author: Fred Wu
# Source code: https://github.com/fredwu/yield.rb
# License: http://fredwu.mit-license.org/

require "yaml"
require "json"
require "openssl"
require "net/http"
require "open-uri"

require_relative "./yield.rb/utils.rb"
require_relative "./yield.rb/exchange.rb"
require_relative "./yield.rb/binance.rb"
require_relative "./yield.rb/bittrex.rb"
require_relative "./yield.rb/coingecko.rb"
require_relative "./yield.rb/manual.rb"
require_relative "./yield.rb/yield.rb"
require_relative "./yield.rb/yieldwatch.rb"

options = YAML.load_file("./config.yml")

data = [
  Thread.new { Manual.new(options["settings"]).parse },
  Thread.new { Binance.new(options["settings"].merge(options["binance"])).parse },
  Thread.new { Bittrex.new(options["settings"].merge(options["bittrex"])).parse },
  Thread.new { YieldWatch.new(options["settings"].merge(options["yieldwatch"])).parse },
].map(&:value)

Yield.new(data, options["settings"]).output()
